<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#f5f5f5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/sidebar.css">
    <link rel="stylesheet" href="assets/css/2fa.css">
    <link rel="icon" type="image/x-icon" href="./assets/images/logo.png">
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Roboto+Mono&display=swap" rel="stylesheet">
    <title>2FA Code Manager</title>
</head>
<body>
    <div class="container" id="appContainer">
        <!-- Login section - initially visible -->
        <div class="login-section" id="loginSection">
            <h2 class="card-title"><i class="fas fa-shield-alt"></i>2FA Code Manager</h2>
            <p class="text-muted mb-4">Sign in to access your 2FA codes across devices</p>
            
            <form id="loginForm">
                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" required>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="password" required>
                </div>
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary" id="loginBtn">Sign In</button>
                    <button type="button" class="btn btn-outline-secondary" id="registerBtn">Create Account</button>
                </div>
            </form>
            
            <button id="installPWA" class="btn btn-info w-100">
                <i class="fas fa-download me-2"></i>Install App
            </button>
        </div>
        
        <!-- Main application - initially hidden -->
        <div class="card" id="mainApp" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="card-title mb-0"><i class="fas fa-shield-alt"></i>2FA Code Manager</h2>
                <div class="user-info">
                    <span class="user-email" id="userEmail" title="">user@example.com</span>
                    <button class="btn" id="logoutBtn" title="Sign Out">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
            <p class="text-muted mb-2">Securely store and manage your two-factor authentication codes</p>
            <div class="sync-status mb-4" id="syncStatus">
                <i class="fas fa-check-circle"></i> All codes synced
            </div>
            
            <div class="mb-4 action-buttons">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAccountModal">
                    <i class="fas fa-plus me-2"></i>Add New Account
                </button>
                <button class="btn btn-outline-primary ms-2" id="exportAccountsBtn" style="background-image: var(--primary-gradient); color: white; border: none;">
                    <i class="fas fa-file-export me-2"></i><span class="button-text">Export</span>
                </button>
                <button class="btn btn-outline-primary ms-2" id="importAccountsBtn" style="background-image: var(--primary-gradient); color: white; border: none;">
                    <i class="fas fa-file-import me-2"></i><span class="button-text">Import</span>
                </button>
                <button class="btn btn-outline-primary ms-2" data-bs-toggle="modal" data-bs-target="#backupSettingsModal" style="background-image: var(--primary-gradient); color: white; border: none;">
                    <i class="fas fa-cloud-upload-alt me-2"></i><span class="button-text">Auto Backup</span>
                </button>
                <button class="btn btn-outline-secondary ms-2" id="refreshAccountsBtn" title="Refresh accounts">
                    <i class="fas fa-sync-alt"></i><span class="button-text">Refresh</span>
                </button>
            </div>
            
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-3">
                <div class="search-container flex-grow-1 me-md-3">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" class="form-control" placeholder="Search accounts...">
                </div>
                
                <!-- View toggle buttons (shown on all screen sizes) -->
                <div class="view-toggle mt-2 mt-md-0">
                    <div class="btn-group" role="group" aria-label="View mode selection">
                        <button type="button" class="btn active" data-view="standard" onclick="changeViewMode('standard')" aria-pressed="true" title="Standard list view">
                            <i class="fas fa-th-list me-1" aria-hidden="true"></i><span class="d-none d-sm-inline">List</span>
                        </button>
                        <button type="button" class="btn" data-view="compact" onclick="changeViewMode('compact')" aria-pressed="false" title="Compact view">
                            <i class="fas fa-list me-1" aria-hidden="true"></i><span class="d-none d-sm-inline">Compact</span>
                        </button>
                        <button type="button" class="btn" data-view="grid" onclick="changeViewMode('grid')" aria-pressed="false" title="Grid view">
                            <i class="fas fa-th me-1" aria-hidden="true"></i><span class="d-none d-sm-inline">Grid</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div id="accountsList" class="thin-scrollbar">
                <!-- Accounts will be dynamically added here -->
                <div class="no-accounts" id="noAccounts">
                    <i class="fas fa-user-shield fa-3x mb-3" style="color: #e0e6ed;"></i>
                    <h5>No 2FA accounts added yet</h5>
                    <p>Add your first account to get started</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Register Modal -->
    <div class="modal fade" id="registerModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create Account</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="registerForm">
                        <div class="mb-3">
                            <label for="regEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="regEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="regPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="regPassword" required minlength="8">
                            <small class="form-text text-muted">Password must be at least 8 characters</small>
                        </div>
                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" id="confirmPassword" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="createAccountBtn">Create Account</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Auto Backup Settings Modal -->
    <div class="modal fade" id="backupSettingsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white" style="background-image: var(--primary-gradient);">
                    <h5 class="modal-title"><i class="fas fa-cloud-upload-alt me-2"></i>Auto Backup Settings</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-3" id="gDriveAuthStatus">
                        <p><i class="fas fa-cloud text-muted fa-3x mb-2"></i></p>
                        <h5>Google Drive Backup</h5>
                        <p class="text-muted">Connect your Google account to enable automatic backups</p>
                        <button class="btn btn-primary mb-3" id="authorizeGDriveBtn">
                            <i class="fab fa-google me-2"></i>Connect Google Drive
                        </button>
                        <div id="gDriveConnected" style="display: none;">
                            <div class="alert alert-success">
                                <i class="fas fa-check-circle me-2"></i>Connected to Google Drive
                            </div>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="alert alert-info">
                        <div class="d-flex">
                            <div class="me-3">
                                <i class="fas fa-info-circle fa-2x"></i>
                            </div>
                            <div>
                                <p class="mb-0">Your backup files will be securely stored in Google Drive and only accessible by you. Backups include your encrypted 2FA codes.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" id="backupNowBtn">
                        <i class="fas fa-cloud-upload-alt me-2"></i>Backup Now
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Account Modal -->
    <div class="modal fade" id="addAccountModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow">
                <div class="modal-header bg-primary text-white" style="background-image: var(--primary-gradient);">
                    <h5 class="modal-title"><i class="fas fa-shield-alt me-2"></i>Add New 2FA Account</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="text-center mb-4 add-account-icon">
                        <div class="account-icon-preview mb-2" id="serviceIconPreview">
                            <i class="fas fa-shield-alt fa-2x"></i>
                        </div>
                    </div>
                    
                    <form id="addAccountForm">
                        <div class="mb-3">
                            <label for="serviceType" class="form-label">Service Type</label>
                            <div class="input-group">
                                <span class="input-group-text" id="selectedServiceIcon"><i class="fas fa-globe"></i></span>
                                <select class="form-select" id="serviceType">
                                    <option value="default">Select service...</option>
                                    <option value="google">Google</option>
                                    <option value="facebook">Facebook</option>
                                    <option value="github">GitHub</option>
                                    <option value="twitter">Twitter</option>
                                    <option value="microsoft">Microsoft</option>
                                    <option value="apple">Apple</option>
                                    <option value="amazon">Amazon</option>
                                    <option value="dropbox">Dropbox</option>
                                    <option value="slack">Slack</option>
                                    <option value="discord">Discord</option>
                                    <option value="linkedin">LinkedIn</option>
                                    <option value="paypal">PayPal</option>
                                    <option value="steam">Steam</option>
                                    <option value="gitlab">GitLab</option>
                                    <option value="wordpress">WordPress</option>
                                    <option value="bitbucket">Bitbucket</option>
                                    <option value="protonmail">ProtonMail</option>
                                    <option value="binance">Binance</option>
                                    <option value="digitalocean">DigitalOcean</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="accountName" class="form-label">Account Name</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-tag"></i></span>
                                <input type="text" class="form-control" id="accountName" required placeholder="e.g. Work Email, Personal Account">
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="secretKey" class="form-label">Secret Key</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-key"></i></span>
                                <input type="text" class="form-control" id="secretKey" required placeholder="Enter the secret key">
                                <button class="btn btn-outline-primary" type="button" id="pasteSecretBtn" title="Paste from clipboard" style="background-image: var(--primary-gradient); color: white; border: none;">
                                    <i class="fas fa-paste"></i>
                                </button>
                            </div>
                            <small class="form-text text-muted mt-1">Enter the secret key provided by the service</small>
                        </div>
                        
                        <div class="d-flex mb-3">
                            <div class="form-check form-switch ms-auto">
                                <input class="form-check-input" type="checkbox" id="pinAccountSwitch">
                                <label class="form-check-label" for="pinAccountSwitch">
                                    <i class="fas fa-thumbtack me-1"></i> Pin this account
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary px-4" id="saveAccountBtn">
                        <i class="fas fa-check me-2"></i>Add Account
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- QR Scanner Modal -->
    <div class="modal fade" id="qrScannerModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Scan QR Code</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-3">
                        <p>Position the QR code within the camera view</p>
                        <video id="qrVideo" playsinline></video>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Backup Success Modal -->
    <div class="modal fade" id="backupSuccessModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title"><i class="fas fa-check-circle me-2"></i>Backup Successful</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center p-4">
                    <div class="mb-3">
                        <i class="fas fa-cloud-upload-alt fa-4x text-success"></i>
                    </div>
                    <h4 class="mb-3">Backup Completed!</h4>
                    <p class="mb-0">Your 2FA codes have been successfully backed up to Google Drive.</p>
                    <p class="text-muted mt-2" id="backupSuccessInfo"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-bs-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Alert container -->
    <div class="alert-container" id="alertContainer"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <!-- Google API Client -->
    <script src="https://apis.google.com/js/api.js" onload="console.log('Google API loaded'); window.gApiLoaded = true;"></script>
    <script src="https://accounts.google.com/gsi/client" onload="console.log('Google Identity Services loaded'); window.gisLoaded = true;"></script>
    
    <!-- Load configuration file -->
    <script src="assets/config.js"></script>
    
    <!-- Initialize Google APIs -->
    
    <!-- Load main application script -->
    <script src="assets/js/app.js"></script>
</body>
</html>
